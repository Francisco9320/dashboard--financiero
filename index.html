<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Dashboard Financiero Personal</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; color: #333;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; color: white; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .header p { font-size: 1.1rem; opacity: 0.9; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .metric-card {
            background: white; border-radius: 15px; padding: 25px; box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border-left: 5px solid; transition: transform 0.3s ease;
        }
        .metric-card:hover { transform: translateY(-5px); }
        .metric-card.income { border-color: #10B981; }
        .metric-card.expense { border-color: #EF4444; }
        .metric-card.debt { border-color: #F59E0B; }
        .metric-card.balance { border-color: #3B82F6; }
        .metric-title { font-size: 0.9rem; color: #666; margin-bottom: 10px; text-transform: uppercase; font-weight: 600; }
        .metric-value { font-size: 1.8rem; font-weight: bold; margin-bottom: 5px; }
        .metric-value.income { color: #10B981; }
        .metric-value.expense { color: #EF4444; }
        .metric-value.debt { color: #F59E0B; }
        .metric-value.balance { color: #3B82F6; }
        .main-content { display: grid; grid-template-columns: 1fr 2fr; gap: 30px; margin-bottom: 30px; }
        .form-section, .transactions-section, .tab-container { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); }
        .form-section { height: fit-content; }
        .section-title { font-size: 1.3rem; margin-bottom: 20px; color: #333; font-weight: 600; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; color: #555; }
        .form-group input, .form-group select {
            width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #3B82F6; }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px;
            border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; width: 100%; transition: transform 0.3s ease;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn-small { padding: 6px 12px; font-size: 0.8rem; width: auto; margin: 0 5px; }
        .btn-danger { background: #EF4444; }
        .btn-success { background: #10B981; }
        .transaction-item {
            display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid #e1e5e9;
            border-radius: 8px; margin-bottom: 10px; transition: box-shadow 0.3s ease;
        }
        .transaction-item:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .transaction-info { flex: 1; }
        .transaction-category { font-weight: 600; margin-bottom: 3px; }
        .transaction-description { font-size: 0.9rem; color: #666; margin-bottom: 2px; }
        .transaction-date { font-size: 0.8rem; color: #999; }
        .transaction-amount { font-weight: bold; font-size: 1.1rem; margin-right: 15px; }
        .transaction-amount.income { color: #10B981; }
        .transaction-amount.expense { color: #EF4444; }
        .transaction-amount.debt { color: #F59E0B; }
        .transaction-actions { display: flex; gap: 5px; }
        .tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid #e1e5e9; }
        .tab {
            padding: 10px 20px; cursor: pointer; border-bottom: 2px solid transparent; font-weight: 500; color: #666; transition: all 0.3s ease;
        }
        .tab.active { color: #3B82F6; border-bottom-color: #3B82F6; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .budget-item { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .budget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .budget-name { font-weight: 600; }
        .budget-progress { background: #e1e5e9; height: 8px; border-radius: 4px; overflow: hidden; margin: 10px 0; }
        .budget-progress-bar { height: 100%; transition: width 0.3s ease; }
        .budget-progress-bar.good { background: #10B981; }
        .budget-progress-bar.warning { background: #F59E0B; }
        .budget-progress-bar.danger { background: #EF4444; }
        .budget-details { display: flex; justify-content: space-between; font-size: 0.9rem; color: #666; }
        .alert { background: #FEF3C7; border: 1px solid #F59E0B; color: #92400E; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .alert-title { font-weight: 600; margin-bottom: 5px; }
        @media (max-width: 768px) {
            .main-content { grid-template-columns: 1fr; }
            .metrics-grid { grid-template-columns: 1fr; }
            .header h1 { font-size: 2rem; }
            .container { padding: 15px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üí∞ Dashboard Financiero</h1>
            <p>Gestiona tus finanzas personales de forma inteligente</p>
        </div>

        <!-- Alertas -->
        <div id="alerts-container"></div>

        <!-- M√©tricas principales -->
        <div class="metrics-grid">
            <div class="metric-card income">
                <div class="metric-title">Total Ingresos</div>
                <div class="metric-value income" id="total-ingresos">$0</div>
            </div>
            <div class="metric-card expense">
                <div class="metric-title">Total Gastos</div>
                <div class="metric-value expense" id="total-gastos">$0</div>
            </div>
            <div class="metric-card debt">
                <div class="metric-title">Total Deudas</div>
                <div class="metric-value debt" id="total-deudas">$0</div>
            </div>
            <div class="metric-card balance">
                <div class="metric-title">Disponible</div>
                <div class="metric-value balance" id="disponible">$0</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tab-container">
            <div class="tabs">
                <div class="tab active" data-tab="dashboard">üìä Dashboard</div>
                <div class="tab" data-tab="budgets">üéØ Presupuestos</div>
                <div class="tab" data-tab="export">üíæ Exportar</div>
            </div>

            <!-- Tab: Dashboard -->
            <div id="dashboard" class="tab-content active">
                <div class="main-content">
                    <!-- Formulario -->
                    <div class="form-section">
                        <h3 class="section-title">Nueva Transacci√≥n</h3>
                        <form id="transaction-form">
                            <div class="form-group">
                                <label>Tipo</label>
                                <select id="type">
                                    <option value="gasto">Gasto</option>
                                    <option value="ingreso">Ingreso</option>
                                    <option value="deuda">Deuda</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Categor√≠a</label>
                                <select id="category" required>
                                    <option value="">Selecciona categor√≠a</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Monto</label>
                                <input type="number" id="amount" placeholder="0" required>
                            </div>
                            <div class="form-group">
                                <label>Descripci√≥n</label>
                                <input type="text" id="description" placeholder="Descripci√≥n opcional">
                            </div>
                            <div class="form-group">
                                <label>Fecha</label>
                                <input type="date" id="date" required>
                            </div>
                            <button type="submit" class="btn">Agregar Transacci√≥n</button>
                        </form>
                    </div>

                    <!-- Lista de transacciones -->
                    <div class="transactions-section">
                        <h3 class="section-title">Transacciones Recientes</h3>
                        <div class="form-group">
                            <select id="filter">
                                <option value="all">Todas</option>
                                <option value="ingreso">Ingresos</option>
                                <option value="gasto">Gastos</option>
                                <option value="deuda">Deudas</option>
                            </select>
                        </div>
                        <div id="transactions-list"></div>
                    </div>
                </div>
            </div>

            <!-- Tab: Presupuestos -->
            <div id="budgets" class="tab-content">
                <div class="main-content">
                    <div class="form-section">
                        <h3 class="section-title">Nuevo Presupuesto</h3>
                        <form id="budget-form">
                            <div class="form-group">
                                <label>Categor√≠a</label>
                                <select id="budget-category" required>
                                    <option value="">Selecciona categor√≠a</option>
                                    <option value="Vivienda">Vivienda</option>
                                    <option value="Alimentaci√≥n">Alimentaci√≥n</option>
                                    <option value="Transporte">Transporte</option>
                                    <option value="Entretenimiento">Entretenimiento</option>
                                    <option value="Salud">Salud</option>
                                    <option value="Educaci√≥n">Educaci√≥n</option>
                                    <option value="Ropa">Ropa</option>
                                    <option value="Servicios">Servicios</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>L√≠mite Mensual</label>
                                <input type="number" id="budget-limit" placeholder="0" required>
                            </div>
                            <button type="submit" class="btn btn-success">Crear Presupuesto</button>
                        </form>
                    </div>
                    <div class="transactions-section">
                        <h3 class="section-title">Presupuestos Activos</h3>
                        <div id="budgets-list"></div>
                    </div>
                </div>
            </div>

            <!-- Tab: Exportar -->
            <div id="export" class="tab-content">
                <div style="text-align: center; padding: 40px;">
                    <h3 class="section-title">Exportar Datos</h3>
                    <p style="margin-bottom: 30px; color: #666;">Descarga tus datos financieros para respaldo o an√°lisis externo</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                            <h4 style="margin-bottom: 10px;">Exportar como JSON</h4>
                            <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">Todos los datos incluyendo transacciones y presupuestos</p>
                            <button class="btn" id="btn-export-json">Descargar JSON</button>
                        </div>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                            <h4 style="margin-bottom: 10px;">Exportar como CSV</h4>
                            <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">Solo transacciones para Excel o Google Sheets</p>
                            <button class="btn btn-success" id="btn-export-csv">Descargar CSV</button>
                        </div>
                    </div>

                    <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                        <h4 style="margin-bottom: 15px;">Resumen de Datos</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <div>
                                <div style="font-size: 1.5rem; font-weight: bold; color: #3B82F6;" id="export-transactions">0</div>
                                <div style="font-size: 0.9rem; color: #666;">Transacciones</div>
                            </div>
                            <div>
                                <div style="font-size: 1.5rem; font-weight: bold; color: #10B981;" id="export-budgets">0</div>
                                <div style="font-size: 0.9rem; color: #666;">Presupuestos</div>
                            </div>
                            <div>
                                <div style="font-size: 1.5rem; font-weight: bold; color: #F59E0B;" id="export-period">Este mes</div>
                                <div style="font-size: 0.9rem; color: #666;">Per√≠odo</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // Datos iniciales
        let transactions = [
            { id: 1, type: 'ingreso', category: 'Salario', amount: 3500000, description: 'Salario mensual', date: '2025-09-01' },
            { id: 2, type: 'gasto', category: 'Vivienda', amount: 800000, description: 'Arriendo', date: '2025-09-05' },
            { id: 3, type: 'gasto', category: 'Alimentaci√≥n', amount: 450000, description: 'Mercado', date: '2025-09-10' },
            { id: 4, type: 'deuda', category: 'Tarjeta', amount: 1200000, description: 'Tarjeta de cr√©dito', date: '2025-09-15' }
        ];

        let budgets = [
            { id: 1, category: 'Alimentaci√≥n', limit: 500000 },
            { id: 2, category: 'Transporte', limit: 300000 },
            { id: 3, category: 'Entretenimiento', limit: 200000 }
        ];

        let editingId = null;

        // <-- Aqu√≠ estaba la parte que faltaba en tu versi√≥n anterior:
        const categories = {
            ingreso: ['Salario', 'Freelance', 'Inversiones', 'Bonos', 'Ventas', 'Otro ingreso'],
            gasto: ['Vivienda', 'Alimentaci√≥n', 'Transporte', 'Entretenimiento', 'Salud', 'Educaci√≥n', 'Ropa', 'Servicios', 'Tecnolog√≠a', 'Otro gasto'],
            deuda: ['Tarjeta', 'Pr√©stamo', 'Hipoteca', 'Cr√©dito educativo', 'Otra deuda']
        };
        // Fin del objeto categories

        // Formatear moneda
        function formatCurrency(amount) {
            if (typeof amount !== 'number') amount = Number(amount) || 0;
            return new Intl.NumberFormat('es-CO', {
                style: 'currency',
                currency: 'COP',
                minimumFractionDigits: 0
            }).format(amount);
        }

        // Actualizar categor√≠as seg√∫n el tipo
        function updateCategories() {
            const typeEl = document.getElementById('type');
            const categorySelect = document.getElementById('category');
            if (!typeEl || !categorySelect) return;

            const type = typeEl.value;
            categorySelect.innerHTML = '<option value="">Selecciona categor√≠a</option>';

            const list = categories[type] || [];
            list.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                categorySelect.appendChild(option);
            });
        }

        // Calcular m√©tricas
        function updateMetrics() {
            const totalIngresos = transactions.filter(t => t.type === 'ingreso').reduce((s,t) => s + Number(t.amount || 0), 0);
            const totalGastos = transactions.filter(t => t.type === 'gasto').reduce((s,t) => s + Number(t.amount || 0), 0);
            const totalDeudas = transactions.filter(t => t.type === 'deuda').reduce((s,t) => s + Number(t.amount || 0), 0);
            const disponible = totalIngresos - totalGastos - totalDeudas;

            document.getElementById('total-ingresos').textContent = formatCurrency(totalIngresos);
            document.getElementById('total-gastos').textContent = formatCurrency(totalGastos);
            document.getElementById('total-deudas').textContent = formatCurrency(totalDeudas);
            const disponibleEl = document.getElementById('disponible');
            disponibleEl.textContent = formatCurrency(disponible);
            disponibleEl.className = 'metric-value ' + (disponible >= 0 ? 'balance' : 'expense');
        }

        // Renderizar transacciones
        function renderTransactions() {
            const container = document.getElementById('transactions-list');
            const filter = document.getElementById('filter') ? document.getElementById('filter').value : 'all';
            if (!container) return;

            const filteredTransactions = transactions.filter(t => filter === 'all' || t.type === filter);
            container.innerHTML = '';

            if (filteredTransactions.length === 0) {
                container.innerHTML = '<p style="color:#666">No hay transacciones para mostrar.</p>';
                return;
            }

            filteredTransactions.forEach(transaction => {
                const div = document.createElement('div');
                div.className = 'transaction-item';

                div.innerHTML = `
                    <div class="transaction-info">
                        <div class="transaction-category">${transaction.category}</div>
                        <div class="transaction-description">${transaction.description || ''}</div>
                        <div class="transaction-date">${transaction.date}</div>
                    </div>
                    <div class="transaction-amount ${transaction.type}">
                        ${formatCurrency(Number(transaction.amount || 0))}
                    </div>
                    <div class="transaction-actions">
                        <button class="btn btn-small" data-id="${transaction.id}" data-action="edit">Editar</button>
                        <button class="btn btn-small btn-danger" data-id="${transaction.id}" data-action="delete">Eliminar</button>
                    </div>
                `;
                container.appendChild(div);
            });

            // Delegaci√≥n simple para botones editar/eliminar
            container.querySelectorAll('button[data-action]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = Number(btn.dataset.id);
                    const action = btn.dataset.action;
                    if (action === 'edit') editTransaction(id);
                    if (action === 'delete') deleteTransaction(id);
                });
            });
        }

        // Renderizar presupuestos
        function renderBudgets() {
            const container = document.getElementById('budgets-list');
            if (!container) return;
            const currentMonth = new Date().toISOString().substring(0,7);
            container.innerHTML = '';

            if (budgets.length === 0) {
                container.innerHTML = '<p style="color:#666">No hay presupuestos activos.</p>';
                return;
            }

            budgets.forEach(budget => {
                const spent = transactions
                    .filter(t => t.type === 'gasto' && t.category === budget.category && t.date.startsWith(currentMonth))
                    .reduce((s,t) => s + Number(t.amount || 0), 0);

                const percentage = Math.min((spent / (budget.limit || 1)) * 100, 100);
                const remaining = (budget.limit || 0) - spent;

                let status = 'good';
                if (percentage >= 100) status = 'danger';
                else if (percentage >= 80) status = 'warning';

                const div = document.createElement('div');
                div.className = 'budget-item';

                div.innerHTML = `
                    <div class="budget-header">
                        <div class="budget-name">${budget.category}</div>
                        <button class="btn btn-small btn-danger" data-id="${budget.id}" data-action="delete-budget">Eliminar</button>
                    </div>
                    <div class="budget-progress">
                        <div class="budget-progress-bar ${status}" style="width: ${percentage}%"></div>
                    </div>
                    <div class="budget-details">
                        <span>Gastado: ${formatCurrency(spent)}</span>
                        <span>L√≠mite: ${formatCurrency(budget.limit)}</span>
                    </div>
                    <div class="budget-details">
                        <span>${percentage.toFixed(0)}% usado</span>
                        <span style="color: ${remaining >= 0 ? '#10B981' : '#EF4444'}">
                            ${remaining >= 0 ? 'Quedan ' + formatCurrency(remaining) : 'Excedido por ' + formatCurrency(Math.abs(remaining))}
                        </span>
                    </div>
                `;
                container.appendChild(div);
            });

            // Delegaci√≥n para eliminar presupuesto
            container.querySelectorAll('button[data-action="delete-budget"]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = Number(btn.dataset.id);
                    deleteBudget(id);
                });
            });
        }

        // Verificar alertas de presupuesto
        function checkBudgetAlerts() {
            const currentMonth = new Date().toISOString().substring(0,7);
            const alertsContainer = document.getElementById('alerts-container');
            if (!alertsContainer) return;
            alertsContainer.innerHTML = '';

            budgets.forEach(budget => {
                const spent = transactions
                    .filter(t => t.type === 'gasto' && t.category === budget.category && t.date.startsWith(currentMonth))
                    .reduce((s,t) => s + Number(t.amount || 0), 0);

                const percentage = (spent / (budget.limit || 1)) * 100;
                const remaining = (budget.limit || 0) - spent;

                if (percentage >= 80) {
                    const alert = document.createElement('div');
                    alert.className = 'alert';
                    alert.innerHTML = `
                        <div class="alert-title">‚ö†Ô∏è Alerta de Presupuesto</div>
                        <div>
                            ${percentage >= 100
                                ? `¬°Has excedido el presupuesto de ${budget.category} por ${formatCurrency(Math.abs(remaining))}!`
                                : `Has gastado el ${percentage.toFixed(0)}% del presupuesto de ${budget.category}`
                            }
                        </div>
                    `;
                    alertsContainer.appendChild(alert);
                }
            });
        }

        // Editar / Eliminar transacci√≥n
        function editTransaction(id) {
            const transaction = transactions.find(t => t.id === id);
            if (!transaction) return;
            document.getElementById('type').value = transaction.type;
            updateCategories();
            document.getElementById('category').value = transaction.category;
            document.getElementById('amount').value = transaction.amount;
            document.getElementById('description').value = transaction.description;
            document.getElementById('date').value = transaction.date;
            editingId = id;
            // Cambiar a tab dashboard si est√°s en otra pesta√±a
            showTab(null, 'dashboard');
        }

        function deleteTransaction(id) {
            if (!confirm('¬øEst√°s seguro de eliminar esta transacci√≥n?')) return;
            transactions = transactions.filter(t => t.id !== id);
            updateMetrics();
            renderTransactions();
            renderBudgets();
            checkBudgetAlerts();
            updateExportStats();
        }

        function deleteBudget(id) {
            if (!confirm('¬øEst√°s seguro de eliminar este presupuesto?')) return;
            budgets = budgets.filter(b => b.id !== id);
            renderBudgets();
            checkBudgetAlerts();
            updateExportStats();
        }

        // Filtrar transacciones
        function filterTransactions() {
            renderTransactions();
        }

        // Manejo de pesta√±as ‚Äî usa event.currentTarget para marcar la pesta√±a activa
        function showTab(event, tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));

            const content = document.getElementById(tabName);
            if (content) content.classList.add('active');

            // marcador de pesta√±a (usa currentTarget si existe; si no, busca por data-tab)
            const tabEl = (event && event.currentTarget) || document.querySelector(`.tab[data-tab="${tabName}"]`);
            if (tabEl) tabEl.classList.add('active');
        }

        // Exportar
        function exportJSON() {
            const data = {
                transactions, budgets,
                summary: {
                    totalIngresos: transactions.filter(t => t.type === 'ingreso').reduce((s,t) => s + Number(t.amount || 0), 0),
                    totalGastos: transactions.filter(t => t.type === 'gasto').reduce((s,t) => s + Number(t.amount || 0), 0),
                    totalDeudas: transactions.filter(t => t.type === 'deuda').reduce((s,t) => s + Number(t.amount || 0), 0)
                },
                exportDate: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `finanzas_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function exportCSV() {
            const headers = ['Fecha', 'Tipo', 'Categor√≠a', 'Descripci√≥n', 'Monto'];
            const csvContent = [
                headers.join(','),
                ...transactions.map(t => [
                    t.date,
                    t.type,
                    t.category,
                    `"${(t.description || '').replace(/"/g,'""')}"`,
                    t.amount
                ].join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `transacciones_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function updateExportStats() {
            const tEl = document.getElementById('export-transactions');
            const bEl = document.getElementById('export-budgets');
            if (tEl) tEl.textContent = transactions.length;
            if (bEl) bEl.textContent = budgets.length;
        }

        // Inicializar cuando la p√°gina cargue
        document.addEventListener('DOMContentLoaded', function init() {
            try {
                // Attach tab listeners (usamos data-tab)
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabName = tab.dataset.tab;
                        showTab(e, tabName);
                    });
                });

                // attach form listeners
                const transactionForm = document.getElementById('transaction-form');
                const budgetForm = document.getElementById('budget-form');
                const filterEl = document.getElementById('filter');
                const typeEl = document.getElementById('type');
                const btnExportJson = document.getElementById('btn-export-json');
                const btnExportCsv = document.getElementById('btn-export-csv');

                if (typeEl) {
                    typeEl.addEventListener('change', updateCategories);
                }

                if (filterEl) filterEl.addEventListener('change', filterTransactions);

                if (transactionForm) {
                    transactionForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        const type = document.getElementById('type').value;
                        const category = document.getElementById('category').value;
                        const amount = Number(document.getElementById('amount').value) || 0;
                        const description = document.getElementById('description').value;
                        const date = document.getElementById('date').value;

                        if (!category || !amount) {
                            alert('Por favor completa categor√≠a y monto.');
                            return;
                        }

                        const transaction = {
                            id: editingId || Date.now(),
                            type, category, amount, description, date
                        };

                        if (editingId) {
                            const index = transactions.findIndex(t => t.id === editingId);
                            if (index >= 0) transactions[index] = transaction;
                            editingId = null;
                        } else transactions.push(transaction);

                        transactionForm.reset();
                        document.getElementById('date').value = new Date().toISOString().split('T')[0];
                        updateCategories();

                        updateMetrics();
                        renderTransactions();
                        renderBudgets();
                        checkBudgetAlerts();
                        updateExportStats();
                    });
                }

                if (budgetForm) {
                    budgetForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        const category = document.getElementById('budget-category').value;
                        const limit = Number(document.getElementById('budget-limit').value) || 0;
                        if (!category || !limit) {
                            alert('Por favor completa categor√≠a y l√≠mite del presupuesto.');
                            return;
                        }
                        budgets.push({ id: Date.now(), category, limit });
                        budgetForm.reset();
                        renderBudgets();
                        checkBudgetAlerts();
                        updateExportStats();
                    });
                }

                if (btnExportJson) btnExportJson.addEventListener('click', exportJSON);
                if (btnExportCsv) btnExportCsv.addEventListener('click', exportCSV);

                // Inicializar UI
                updateCategories();
                updateMetrics();
                renderTransactions();
                renderBudgets();
                checkBudgetAlerts();
                updateExportStats();
                // fecha por defecto
                const dateEl = document.getElementById('date');
                if (dateEl) dateEl.value = new Date().toISOString().split('T')[0];
            } catch (err) {
                console.error('Error inicializando la app:', err);
            }
        }, { once: true });
    </script>
</body>
</html>
